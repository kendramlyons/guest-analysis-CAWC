---
title: "CAWC Arrivals Report"
author: "Kendra Lyons"
date: "2/2/2022"
output: html_document
---

```{r setup, include=FALSE}
library(knitr)
library(tidyverse)
opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
```

## Data

```{r cawc}
arrivals_7_day <- read_csv("data/arrival_date_counts_1.20.csv")
individuals <- read_csv("data/individual_all_clean_1_20_22.csv")
```

# Dates: 1/26/21-1/20/22

## Arrivals Timelines

```{r arrivals, echo=FALSE, message=FALSE}

par(mfrow = c(1, 3))

# plot daily total arrivals (bars) with individual seven-day rolling mean (purple line)

ggplot(arrivals_7_day, aes(x=arrival_date, y=n))+
  geom_col(fill='orange')+
  geom_line(aes(y = seven_avg), color='purple', size=.8)+
  ggtitle("Daily Individual Arrivals")+
  theme_bw() +
  theme(text = element_text(size=15), axis.text.x = element_text(angle = 45, hjust=1))+
  xlab("Arrival Date")+
  ylab("Number of Individuals")+ 
  scale_x_date(date_breaks="1 month", date_labels="%B")

# weekly arrivals barplot with linear regression

arrivals_wk <- individuals %>%
  count(week_number)

arrivals_wk %>%
  ggplot(aes(x = week_number, y = n)) +
  geom_bar(stat = "identity", fill = 'orange') +
  geom_smooth(method = "lm", formula = y ~ x, color = 'purple', size=.8) +
  theme_bw() +
  theme(text = element_text(size=15), axis.text.x = element_text(angle = 45, hjust=1)) +
  ggtitle("Weekly Individual Arrivals")+
  xlab("Arrival Week Number") +
  ylab("Number of Individuals")

# Examine monthly arrivals
monthly_arrivals <- individuals %>%
  count(week_number, arrival_month, arrival_year)

monthly_arrivals %>% #average weekly arrivals by month boxplots
  mutate(arrival_month = factor(arrival_month)) %>%
  ggplot(aes(x = arrival_month, y = n)) +
  geom_boxplot(varwidth = TRUE, outlier.color = "red") +
  ylab("Number of Weekly Arrivals") +
  xlab("Arrival Month Jan. 2021 (1) - Jan. 2022 (13)") +
  ggtitle("Weekly Arrivals by Month") +
  theme(text = element_text(size=15))

```

## Stay Length by Group Size

```{r echo=FALSE}

par(mfrow = c(1, 3))

# Boxplots of stay lengths for various group sizes
individuals %>%
  filter(stay_length >= 0) %>% 
  mutate(group_size = factor(number_in_party)) %>%
  ggplot(aes(x = stay_length, y = number_in_party)) +
  geom_boxplot(aes(group = number_in_party), varwidth = TRUE, outlier.color = "red",)  + # zoom in on plot because there are a few large outliers
  ylab("Group Size") +
  xlab("Stay Length in Days (0-90)") 

# Look at distribution of individuals by group size for stays from 0-30 days
individuals %>%
  filter(stay_length >= 0) %>% 
  ggplot(aes(x = stay_length, y = number_in_party)) +
  geom_jitter(alpha = .2) +
  xlim(0, 30) +  
  ylab("Group Size") +
  xlab("Stay Length in Days (0-30)") 

# look at stay length distribution for individuals in parties fewer than 7
individuals %>%
  filter(stay_length >= 0 & number_in_party < 7) %>% #filter out mistakes in recording year (negative values)
  ggplot(aes(x = stay_length)) +
  geom_bar() +
  xlim(0, 20) +
  facet_wrap(~number_in_party) +
  ggtitle("Stay Length, Groups of 6 or Fewer") +
  ylab("Number of Individuals") +
  xlab("Stay Length in Days (0-20)")

```


```{r echo=FALSE}

```

